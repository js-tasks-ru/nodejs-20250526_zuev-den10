# Задание: Реализация CRUD для задач на MongoDB

В этом задании вы создадите NestJS-приложение, которое будет управлять коллекцией задач в **MongoDB**. Помимо
стандартных CRUD-операций, вам предстоит:

- Реализовать **кастомный Pipe** для проверки корректности MongoDB ObjectId.
- Настроить **глобальный Exception Filter** для обработки ошибок валидации и ошибок MongoDB (например, ошибки уникальности).

---

## Что нужно сделать

1. **Создать Task-модель и схему** в Mongoose:

   - Используйте хотя бы одно уникальное поле, `title`.
   - Определите типы полей (`title`, `description`, `isCompleted`).

2. **Настроить CRUD-операции** (создание, чтение, обновление, удаление) с помощью NestJS:

   - Создайте сервис и контроллер для управления задачами.
   - Используйте типы DTO и `class-validator` для валидации входящих данных.

3. **Реализовать ObjectIdPipe**:

   - Создайте кастомный Pipe (`ObjectIDPipe`), который проверяет корректность переданного в URL идентификатора задачи.
   - Если ID некорректен, Pipe должен выбрасывать `BadRequestException` с понятным сообщением.

4. **Реализовать Exception Filter** для обработки ошибок Mongoose:

   - Создайте глобальный Exception Filter (`MongoFilter`), который перехватывает:
     - `mongoose.Error.ValidationError` — ошибки валидации Mongoose.
     - `mongoose.mongo.MongoError` — ошибки MongoDB (например, дублирование уникальных полей).
   - При перехвате таких ошибок, фильтр должен возвращать ответ с кодом **400 Bad Request** и сообщением об ошибке.

5. **Интегрировать Pipe и Filter**:
   - Зарегистрируйте `ObjectIDPipe` в контроллере для всех маршрутов, использующих параметр `id`.
   - Зарегистрируйте `MongoFilter` глобально (в `main.ts`), чтобы он обрабатывал ошибки для всего приложения.

---

## Эндпоинты CRUD

1. **Создать задачу**  
   **POST** `/tasks`  
   Параметры (body): `title`, `description?`

   Пример запроса:

   ```http
   POST http://localhost:3000/tasks
   {
     "title": "Уникальное название",
     "description": "Описание задачи"
   }
   ```

   Возможные ответы:

   - **200 OK**: возвращает созданную задачу.
   - **400 Bad Request**: если `title` уже существует или не проходит валидацию.

2. **Получить все задачи**  
   **GET** `/tasks`  
   Без дополнительных параметров. Возвращает массив всех задач.

   Пример запроса:

   ```http
   GET http://localhost:3000/tasks
   ```

   Пример ответа:

   ```json
   [
     {
       "_id": "64b2f47d...",
       "title": "Уникальное название",
       "description": "Описание задачи",
       "isCompleted": false
     }
   ]
   ```

3. **Получить задачу по ID**  
   **GET** `/tasks/:id`  
   Параметр (path): `id`

   Пример запроса:

   ```http
   GET http://localhost:3000/tasks/64b2f47d...
   ```

   Возможные ответы:

   - **200 OK**: возвращает найденную задачу.
   - **400 Bad Request**: если `id` некорректен (за счёт работы `ObjectIDPipe`).
   - **404 Not Found**: если задача не найдена.

4. **Обновить задачу**  
   **PATCH** `/tasks/:id`  
   Параметры (body): любые поля для обновления (title, description, isCompleted).

   Пример запроса:

   ```http
   PATCH http://localhost:3000/tasks/64b2f47d...
   {
     "isCompleted": true
   }
   ```

   Возможные ответы:

   - **200 OK**: возвращает обновлённую задачу.
   - **400 Bad Request**: при конфликте уникальности, некорректном `id` или ошибке валидации.
   - **404 Not Found**: если задача с таким ID не найдена.

5. **Удалить задачу**  
   **DELETE** `/tasks/:id`  
   Параметр (path): `id`.

   Пример запроса:

   ```http
   DELETE http://localhost:3000/tasks/64b2f47d...
   ```

   Возможные ответы:

   - **200 OK**: возвращает подтверждение удаления.
   - **400 Bad Request**: если `id` некорректен.
   - **404 Not Found**: если задача не найдена.

---

## Дополнительные задачи (опционально)

1. **Расширьте валидацию**:
   - Проверьте минимальную длину `title`, наличие обязательных полей и т.д. с помощью `class-validator`.

2**Добавьте дополнительные поля**:

- Например, дедлайн, приоритет, и т.п., с соответствующей валидацией и логикой.

---

## Ожидаемый результат

В итоге вы получите NestJS-приложение с полноценными CRUD-операциями, реализованным кастомным Pipe для валидации
ObjectId и глобальным Exception Filter для обработки ошибок валидации и MongoDB. Это обеспечит надёжную работу с
задачами, корректную обработку некорректных запросов и удобное информирование пользователя об ошибках.
