# Задание: Использование Middleware, Pipes, Guards, Interceptors и Error Handlers

В этом задании вам предстоит разработать приложение для управления задачами, применяя ключевые концепции NestJS:
Middleware, Pipes, Guards, Interceptors и Error Handlers. Задание направлено на закрепление понимания жизненного цикла
запросов и методов обработки данных.

---

## Общая структура задачи

1. Middleware — Логирование запросов.
2. Pipe — Проверка и преобразование данных.
3. Guard — Ограничение доступа по роли пользователя.
4. Interceptor — Модификация ответов API.
5. Error Handler — Централизованная обработка ошибок.

---

### Middleware: Логирование запросов

| Цель | Логировать каждый запрос, фиксируя метод, путь и время выполнения. |
| ---- | ------------------------------------------------------------------ |

Пример логирования:

```plaintext
[GET] /tasks
```

1. Реализуйте Middleware для логирования запросов.
2. Логируйте метод и путь запроса.
3. Примените Middleware ко всем маршрутам.

---

### Pipe: Проверка и преобразование данных

| Цель | Проверить, является ли параметр маршрута `id` числом, и преобразовать его. |
| ---- | -------------------------------------------------------------------------- |

1. Реализуйте Pipe для проверки параметра `id` в маршруте `/tasks/:id`.
2. Если `id` не является числом, выбросите исключение `BadRequestException` с сообщением `"${value}" не является числом`.
3. Преобразуйте `id` в числовой тип перед передачей в контроллер.

Пример:

- Запрос: `GET /tasks/abc` -> Ответ: `400 Bad Request`.
- Запрос: `GET /tasks/123` -> Успешный ответ.

---

### Guard: Ограничение доступа по роли

| Цель | Разрешить доступ только пользователям с ролью `admin`. |
| ---- | ------------------------------------------------------ |

1. Реализуйте Guard для проверки роли пользователя, передаваемой в заголовке `x-role`.
2. Если роль отсутствует или отличается от `admin`, выбросите исключение `ForbiddenException`.
3. Подключите Guard для создания и удаления задачи (остальные маршруты должны быть доступны всем).

Пример:

- Заголовок `x-role: user` -> Ответ: `403 Forbidden`.
- Заголовок `x-role: admin` -> Успешный доступ.

---

### Interceptor: Модификация ответов API

| Цель | Добавить поле `apiVersion` и измерить время выполнения запроса. |
| ---- | --------------------------------------------------------------- |

1. Реализуйте Interceptor, который добавляет в каждый ответ поле `apiVersion: "1.0"`.
2. Логируйте время выполнения запроса в миллисекундах и добавляйте его в ответ (`executionTime`).

Пример ответа:

```json
{
  "tasks": ["Task 1", "Task 2"],
  "apiVersion": "1.0",
  "executionTime": 12
}
```

---

### Error Handler: Централизованная обработка ошибок

| Цель | Унифицировать формат ошибок и логировать их в файл. |
| ---- | --------------------------------------------------- |

1. Реализуйте глобальный Error Handler для обработки исключений.
2. Логируйте все ошибки в файл `errors.log` с указанием времени и сообщения. Используйте для этого метод `.appendFileSync` модуля `fs`.
3. Возвращайте клиенту унифицированный ответ:
   ```json
   {
     "statusCode": 400,
     "message": "Описание ошибки",
     "timestamp": "2024-12-23T12:00:00.000Z"
   }
   ```

Пример записи в `errors.log`:

```plaintext
[2024-12-23T12:00:00.000Z] 400 - Invalid ID
```

---

## Дополнительные (опциональные) задачи

1. Расширьте Guard для проверки авторизации через JWT:
   - Проверяйте токен и извлекайте роль пользователя из него.
